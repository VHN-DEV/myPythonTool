# Scan Malware - Quét mã độc trong code

## Mô tả

Tool quét và phát hiện mã độc, backdoor, shell trong file code (PHP, JavaScript, Python). Phát hiện các pattern nghi ngờ như eval(), base64_decode(), shell_exec() và nhiều hàm nguy hiểm khác.

## Tính năng

✅ Quét file PHP (*.php)
✅ Quét file JavaScript (*.js)
✅ Quét file Python (*.py)
✅ Quét tất cả file (PHP + JS + Python)
✅ Custom extension
✅ Phát hiện nhiều pattern nguy hiểm
✅ Export kết quả ra CSV
✅ Hiển thị chi tiết file nghi ngờ

## Yêu cầu

Không cần cài đặt thư viện bên ngoài (sử dụng thư viện chuẩn của Python).

## Cách sử dụng

### Chạy từ menu chính

```bash
myptool
# Chọn tool "scan-malware"
```

### Chạy trực tiếp

```bash
python tools/py/scan-malware/scan-malware.py
```

## Hướng dẫn chi tiết

### 1. Nhập đường dẫn

1. Nhập đường dẫn thư mục cần quét (vd: `./project`, `D:\www\public_html`)
2. Tool sẽ quét đệ quy tất cả thư mục con

### 2. Chọn loại file

Chọn loại file cần quét:
- **1**: PHP files (*.php)
- **2**: JavaScript files (*.js)
- **3**: Python files (*.py)
- **4**: Tất cả (PHP + JS + Python)
- **5**: Custom (nhập extension, vd: `txt,log`)

### 3. Quét và phân tích

Tool sẽ:
1. Tìm tất cả file có extension được chọn
2. Quét từng file để tìm pattern nghi ngờ
3. Phân tích và đánh giá mức độ nguy hiểm
4. Hiển thị kết quả trên console
5. Export kết quả ra file CSV

### 4. Kết quả

**Trên console:**
- Danh sách file nghi ngờ
- Pattern tìm thấy trong mỗi file
- Dòng code chứa pattern
- Mức độ nguy hiểm

**File CSV:**
- Tên file
- Đường dẫn file
- Pattern tìm thấy
- Dòng code
- Mức độ nguy hiểm
- Timestamp

## Pattern được phát hiện

### PHP

#### Hàm nguy hiểm:
- `eval()`: Thực thi code PHP từ string
- `base64_decode()`: Giải mã base64 (thường dùng để ẩn code)
- `shell_exec()`: Thực thi lệnh shell
- `system()`: Thực thi lệnh system
- `passthru()`: Thực thi lệnh và hiển thị output
- `exec()`: Thực thi lệnh
- `preg_replace()` với `/e`: Thực thi code qua regex

#### Hàm file nguy hiểm:
- `file_get_contents()` với URL từ xa
- `fopen()` với URL từ xa
- `include()` / `require()` với biến
- `file_put_contents()` với dữ liệu từ xa

#### Hàm mã hóa:
- `gzinflate()`: Giải nén (thường dùng để ẩn code)
- `str_rot13()`: Mã hóa ROT13
- `hex2bin()`: Chuyển hex sang binary

### JavaScript

#### Hàm nguy hiểm:
- `eval()`: Thực thi code JavaScript từ string
- `Function()`: Tạo function từ string
- `setTimeout()` / `setInterval()` với string
- `document.write()`: Ghi nội dung vào DOM

#### Code injection:
- `innerHTML` với dữ liệu từ xa
- `outerHTML` với dữ liệu từ xa
- `document.createElement()` với dữ liệu từ xa

### Python

#### Hàm nguy hiểm:
- `eval()`: Thực thi code Python từ string
- `exec()`: Thực thi code Python
- `compile()`: Biên dịch code từ string
- `__import__()`: Import module động

#### Hàm system:
- `os.system()`: Thực thi lệnh system
- `subprocess.call()`: Thực thi process
- `os.popen()`: Mở pipe đến lệnh

## Mức độ nguy hiểm

### Cao (High)
- `eval()`, `exec()`, `system()`
- Code injection rõ ràng
- Backdoor pattern

### Trung bình (Medium)
- `base64_decode()` với `eval()`
- `file_get_contents()` với URL từ xa
- Hàm mã hóa/giải mã

### Thấp (Low)
- Pattern có thể là false positive
- Hàm nguy hiểm nhưng context an toàn

## Ví dụ

### Quét thư mục PHP

```
Thư mục: ./public_html
Loại file: 1 (PHP)
→ Quét tất cả file .php
→ Tìm thấy 2 file nghi ngờ:

1. ./public_html/upload.php
   Pattern: eval(base64_decode(...))
   Dòng: 45
   Mức độ: Cao

2. ./public_html/admin/config.php
   Pattern: file_get_contents($url)
   Dòng: 12
   Mức độ: Trung bình

→ Xuất ra: malware_scan_2025-01-15_143022.csv
```

### Quét tất cả file

```
Thư mục: ./project
Loại file: 4 (Tất cả)
→ Quét file PHP, JS, Python
→ Tìm thấy 5 file nghi ngờ
→ Xuất ra: malware_scan_2025-01-15_143022.csv
```

## Tips

### Quét định kỳ:
- Quét định kỳ các dự án đang phát triển
- Quét trước khi deploy lên production
- Quét sau khi nhận code từ nguồn không tin cậy

### Kiểm tra kết quả:
- Xem xét kỹ các file có pattern nghi ngờ
- Không phải tất cả pattern đều là mã độc (có thể là false positive)
- Kiểm tra context của code để đánh giá

### False Positive:
- Một số pattern có thể là false positive
- Cần kiểm tra thủ công các file nghi ngờ
- Tool chỉ phát hiện pattern, không phân tích logic

## Use case phổ biến

- **Bảo mật**: Quét mã độc trong dự án
- **Audit**: Kiểm tra code trước khi deploy
- **Incident response**: Phân tích sau khi bị tấn công
- **Code review**: Kiểm tra code từ nguồn không tin cậy
- **Compliance**: Đảm bảo code không chứa mã độc

## Lưu ý

- **False Positive**: Tool có thể báo false positive, cần kiểm tra thủ công
- **Không thay thế antivirus**: Tool chỉ quét pattern, không phát hiện virus thực sự
- **Context**: Cần xem xét context của code để đánh giá chính xác
- **Cập nhật pattern**: Pattern có thể không phát hiện được tất cả mã độc mới
- **Backup**: Luôn backup code trước khi quét/xử lý

## Bảo mật

- **Không chạy code nghi ngờ**: Không chạy code từ file nghi ngờ
- **Cách ly**: Cách ly file nghi ngờ cho đến khi xác nhận an toàn
- **Báo cáo**: Báo cáo ngay nếu phát hiện mã độc thực sự
- **Xóa an toàn**: Xóa file nghi ngờ một cách an toàn sau khi xác nhận

## Ví dụ thực tế

### Quét dự án web

```
Thư mục: D:\www\public_html
Loại file: 1 (PHP)
→ Quét 150 file PHP
→ Tìm thấy 3 file nghi ngờ
→ Kiểm tra thủ công
→ Phát hiện 1 file chứa backdoor
→ Xóa file và khôi phục từ backup
```

### Quét trước khi deploy

```
Thư mục: ./src
Loại file: 4 (Tất cả)
→ Quét toàn bộ source code
→ Không tìm thấy pattern nghi ngờ
→ An toàn để deploy
```

